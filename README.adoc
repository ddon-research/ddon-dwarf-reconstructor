= DDON DWARF Reconstructor

Reconstructs C++ header files from DWARF debug symbols in PS4 ELF files using native pyelftools.

== Features

* **Native pyelftools integration**: Uses proven DWARF library directly
* **Superior type resolution**: Resolves complex types like `const MtDTI&`, `MtUI*`  
* **Clean C++ output**: Proper virtual methods, static members, vtable pointers
* **Context management**: Automatic resource cleanup with context managers
* **Fast execution**: ~0.3s generation time for typical classes
* **Structured logging**: Timestamped log files in `logs/` directory
* **PS4 ELF support**: Handles PS4-specific ELF variations

== Requirements

* Python 3.10+
* pyelftools
* ELF file with DWARF debug information

== Installation

[source,bash]
----
# Using uv (recommended)
uv sync

# Or using pip
pip install -e .
----

== Usage

=== Command Line Interface

[source,bash]
----
# Generate header (quiet mode - default)
python main.py resources/DDOORBIS.elf --generate MtObject

# Generate header (verbose mode with debug logs)
python main.py resources/DDOORBIS.elf --generate MtObject --verbose

# Custom output directory
python main.py resources/DDOORBIS.elf --generate MtObject -o headers/
----

=== Using .env Configuration

[source,bash]
----
# Create .env file
echo "ELF_FILE_PATH=resources/DDOORBIS.elf" > .env

# Now you can omit the ELF path
python main.py --generate MtObject
----

=== Output

* **Headers**: Generated in `output/` directory as `<symbol>.h`
* **Logs**: Timestamped files in `logs/` directory (e.g., `ddon_reconstructor_20251007_143052.log`)

[source,bash]
----
# Example output structure
output/
  MtObject.h
logs/
  ddon_reconstructor_20251007_143052.log
----

=== Verbose vs. Quiet Mode

**Quiet Mode (default)**:
[source]
----
INFO: Generating header for: MtObject
INFO: Found MtObject in CU at offset 0xc9d
INFO: [SUCCESS] Generated: output/MtObject.h
INFO: Size: 784 bytes
----

**Verbose Mode (`--verbose`)**:
[source]
----
DEBUG: ELF file: resources/DDOORBIS.elf
DEBUG: Output directory: output
INFO: Generating header for: MtObject
INFO: Found MtObject in CU at offset 0xc9d
DEBUG: DIE DW_TAG_subprogram has no DW_AT_type attribute
INFO: [SUCCESS] Generated: output/MtObject.h
DEBUG: Preview (first 30 lines):
... (header content preview)
DEBUG: ============================================================
----

== Architecture

[source]
----
src/ddon_dwarf_reconstructor/
├── core/           # DWARF constants and enums
│   └── models.py          # DWTag, DWAccessibility, DWVirtuality enums
├── generators/     # C++ header generation
│   └── native_generator.py  # Native pyelftools implementation
├── config/         # Configuration management
│   └── config.py          # Config with .env support
├── utils/          # Utilities
│   ├── logger.py          # Centralized logging
│   └── elf_patches.py     # PS4 ELF compatibility patches
└── main.py         # CLI entry point
----

== Testing

[source,bash]
----
# Run all tests
uv run pytest

# Run specific test categories
uv run pytest -m unit               # Unit tests only
uv run pytest -m integration        # Integration tests only
uv run pytest -m "not slow"         # Fast tests (skip slow ones)

# Verbose output with short tracebacks
uv run pytest -v --tb=short
----

== Performance

* **Fast execution**: ~0.3s generation for typical classes
* **Native pyelftools**: Leverages optimized DWARF library
* **Direct type resolution**: Uses built-in `get_DIE_from_attribute()`
* **Low memory usage**: Context manager ensures proper cleanup
* **Simple architecture**: No complex caching or indexing needed

== Development

[source,bash]
----
# Install with development dependencies
uv sync

# Run type checking
uv run mypy src/

# Run linting
uv run ruff check src/

# Format code
uv run ruff format src/
----

== Configuration Priority

Configuration is loaded in this order (later overrides earlier):

1. `.env` file
2. Environment variables
3. Command-line arguments

Example:
[source,bash]
----
# .env file
ELF_FILE_PATH=resources/DDOORBIS.elf
OUTPUT_DIR=output
VERBOSE=false

# Override with CLI
python main.py --verbose  # Uses .env ELF path but enables verbose
----

== Sample Output

Generated `MtObject.h`:
[source,cpp]
----
class MtObject
{
public:
    virtual ~MtObject();
    virtual MtUI* createUI();
    virtual bool isEnableInstance();
    virtual void createProperty();
    virtual const MtDTI& getDTI();
public:
    void* _vptr$MtObject;  // offset: 0x0

    // Static members
    static const u32 INITIAL_ALLOCATOR = 0;
    static MyDTI DTI;
};
----

== Known Limitations

* PS4 ELF files may have non-standard sections requiring lenient parsing
* Some DWARF constructs may not be fully supported
* Currently focused on class/struct generation

== License

MIT

== Contributing

Contributions welcome! Please ensure:

* All tests pass: `uv run pytest`
* Type checking passes: `uv run mypy src/`
* Linting passes: `uv run ruff check src/`
* Follow existing code style
